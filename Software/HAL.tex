% !TEX root = BA-Bauer.tex
\subsection{Hardwareabstraktionsschicht HAL (Hardware Abstraction Layer)}
Bei der Programmierung eines Mikrocontrollers muss selbstverständlich eine für den Mikrocontroller verständliche Sprache gesprochen werden. Möchte man beispielsweise ein Byte mithilfe der UART-Schnittstelle senden, so muss der intern verbundene entsprechnende Pin das Signal ausgeben. Wird nun der selbe Programmcode für einen anderen Mikrokontroller verwendet, ist der Ausgangspin des UARTs eventuell ein anderer und der Programmcode wird nicht funktionieren. Die Lösung des Problems ist entweder das Ändern des Programmcodes oder die Verwendung der Hardwareabstraktionsschicht (HAL). Die HAL trennt die Anwendungsschicht von der Hardwareschicht, sodass der Programmcode unabhängig von der Hardware geschrieben werden kann. Bei der Programmierung werden HAL-Funktionen aufgerufen, welche dann die entsprechenden Hardware-Operationen durchführen. Die HAL ist außerdem in einzelne Komponenten aufgeteilt, wie z.B. die UART-Schnittstelle oder Timer \cite[S.77 ff.]{IoTSystems}. Als Beispiel soll ein Byte über die UART-Schnittstelle gesendet werden. Im Hauptprogramm wird dafür die Funktion $HAL\_UART\_Transmit(...)$ aus der Datei $stm32f4xx\_hal\_uart.c$ aufgerufen. In dieser Funktion wird die UART-Schnittstelle für das Senden vorbereitet, das Byte in das entsprechende Datenregister geschrieben und anschließend der Sendevorgang gestartet. Dabei werden in der Funktion nur bestehende Konstanten der Registeradressen verwendet. Diese Konstanten sind in der Datei $stm32f446xx.h$ definiert. Soll der Programmcode nun auf einem STM32F401CE Mikrocontroller laufen, so muss lediglich die Datei $stm32f446xx.h$ ersetzt werden. Voraussetzung dafür ist, dass alle Schnittstellen, die im Programmcode verwendet werden, auch in dem neuen Mikrocontroller existieren. Die HAL-Treiber und Definitionen der Mikrocontroller müssen in der Regel nicht händisch programmiert werden, sondern werden vom Hersteller des Mikrocontrollers zur Verfügung gestellt. STMicroelectronics bietet darüber hinaus kostenlose Software mit der der Umgang mit den hochkomplexen Mikrocontrollern vereinfacht wird.